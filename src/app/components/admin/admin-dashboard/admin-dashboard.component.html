<main class="admin-dashboard">
  <div class="container">
    <h1 class="page-title">Admin Dashboard</h1>
    
    <!-- Loading and Error States -->
    <div *ngIf="loading" class="loading-state">
      <p>Loading admin data...</p>
    </div>
    
    <div *ngIf="error" class="error-state">
      <p>{{ error }}</p>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="M38.67-160v-100q0-34.67 17.83-63.17T105.33-366q69.34-31.67 129.67-46.17 60.33-14.5 123.67-14.5 63.33 0 123.33 14.5T611.33-366q31 14.33 49.17 42.83T678.67-260v100h-640Zm706.66 0v-102.67q0-56.66-29.5-97.16t-79.16-66.84q63 7.34 118.66 22.5 55.67 15.17 94 35.5 34 19.34 53 46.17 19 26.83 19 59.83V-160h-176ZM358.67-480.67q-66 0-109.67-43.66Q205.33-568 205.33-634T249-743.67q43.67-43.66 109.67-43.66t109.66 43.66Q512-700 512-634t-43.67 109.67q-43.66 43.66-109.66 43.66ZM732-634q0 66-43.67 109.67-43.66 43.66-109.66 43.66-11 0-25.67-1.83-14.67-1.83-25.67-5.5 25-27.33 38.17-64.67Q578.67-590 578.67-634t-13.17-80q-13.17-36-38.17-66 12-3.67 25.67-5.5 13.67-1.83 25.67-1.83 66 0 109.66 43.66Q732-700 732-634ZM105.33-226.67H612V-260q0-14.33-8.17-27.33-8.16-13-20.5-18.67-66-30.33-117-42.17-51-11.83-107.66-11.83-56.67 0-108 11.83-51.34 11.84-117.34 42.17-12.33 5.67-20.16 18.67-7.84 13-7.84 27.33v33.33Zm253.34-320.66q37 0 61.83-24.84Q445.33-597 445.33-634t-24.83-61.83q-24.83-24.84-61.83-24.84t-61.84 24.84Q272-671 272-634t24.83 61.83q24.84 24.84 61.84 24.84Zm0 320.66Zm0-407.33Z"/></svg></div>
        <div class="stat-number">{{ totalUsers }}</div>
        <div class="stat-label">Total Users</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="M390-240q-27.5 0-47.08-19.58-19.59-19.59-19.59-47.09V-368q-58.58-39.68-90.95-101.74Q200-531.8 200-602q0-116.16 81.83-197.08Q363.67-880 480.33-880 597-880 678.5-798.5 760-717 760-600q0 70.33-32.5 131.5T636.67-368v61.33q0 27.5-19.59 47.09Q597.5-240 570-240H390Zm3.33-66.67h173.34V-400L602-424.67q43.54-29.96 67.44-76.51 23.89-46.56 23.89-99 0-88.82-62.16-150.99Q569-813.33 480-813.33q-89 0-151.17 62.57-62.16 62.57-62.16 151.35 0 52.41 23.89 98.68 23.9 46.28 67.44 76.06l35.33 24.42v93.58ZM398-80q-14.17 0-23.75-9.58-9.58-9.59-9.58-23.75v-33.34H596v33.45q0 14.22-9.58 23.72-9.59 9.5-23.75 9.5H398Zm82-520Z"/></svg></div>
        <div class="stat-number">{{ totalIdeas }}</div>
        <div class="stat-label">Total Ideas</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="M66.67-400q-27 0-46.84-19.83Q0-439.67 0-466.67v-260q0-10.66 3.67-19.66 3.66-9 11.66-17.67l196-196L238-931.67q5.33 5.67 8.67 12.5 3.33 6.84 3.33 14.5v8L220-760h213.33q19.84 0 33.25 13.42Q480-733.17 480-713.33v42.66q0 6.67-1 12.17t-2.33 8.5l-92 217.33q-6.39 15.43-20.53 24.05Q350-400 330-400H66.67ZM326-466.67l87.33-204v-22.66h-276L164-818l-97.33 97.33v254H326ZM748.67 0 722-28.33q-5.33-5.67-8.67-12.5-3.33-6.84-3.33-14.5v-8L740-200H526.67q-19.84 0-33.25-13.42Q480-226.83 480-246.67v-42.66q0-6.67 1-12.17t2.33-8.5l92-217.33Q582-543 596-551.5q14-8.5 34-8.5h263.33q27 0 46.84 19.83Q960-520.33 960-493.33v260q0 10.66-3.5 19.5Q953-205 944.67-196l-196 196ZM634-493.33l-87.33 204v22.66h276L796-142l97.33-97.33v-254H634ZM66.67-474.67v-246 246Zm826.66-10.66v246-246Z"/></svg></div>
        <div class="stat-number">{{ totalVotes }}</div>
        <div class="stat-label">Total Votes</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="M240-399.33h315.33V-466H240v66.67ZM240-526h480v-66.67H240V-526Zm0-126.67h480v-66.66H240v66.66ZM80-80v-733.33q0-27 19.83-46.84Q119.67-880 146.67-880h666.66q27 0 46.84 19.83Q880-840.33 880-813.33v506.66q0 27-19.83 46.84Q840.33-240 813.33-240H240L80-80Zm131.33-226.67h602v-506.66H146.67v575l64.66-68.34Zm-64.66 0v-506.66 506.66Z"/></svg></div>
        <div class="stat-number">{{ totalComments }}</div>
        <div class="stat-label">Total Comments</div>
      </div>
    </div>
    
    <div class="admin-content">
      <div class="admin-section">
        <h2 class="section-title">Top Ideas</h2>
        <div class="top-ideas">
          <div *ngFor="let idea of topIdeas" class="top-idea-card">
            <h3 class="idea-title">{{ idea.title }}</h3>
            <div class="idea-meta">
              <span class="idea-author">{{ getUserName(idea.user) }}</span>
              <span class="idea-votes">{{ idea.upVotes + idea.downVotes }} votes</span>
            </div>
            <div class="vote-bars">
              <div class="vote-bar upvotes" [style.width.%]="getUpvotePercentage(idea)">
                {{ idea.upVotes }}
              </div>
              <div class="vote-bar downvotes" [style.width.%]="getDownvotePercentage(idea)">
                {{ idea.downVotes }}
              </div>
            </div>
            <div class="idea-actions">
              <button class="btn btn-text" (click)="viewIdeaDetails(idea)">View Details</button>
              <button class="btn btn-text" (click)="viewComments(idea)">View Comments ({{ idea.commentCount }})</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="admin-section">
        <h2 class="section-title">Recent Activity</h2>
        <div class="activity-feed">
          <div *ngFor="let activity of recentActivities" class="activity-item" [ngClass]="activity.type">
            <div class="activity-icon">
              <span *ngIf="activity.type === 'idea_submitted'"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff7a00"><path d="M400-240q-33 0-56.5-23.5T320-320v-50q-57-39-88.5-100T200-600q0-117 81.5-198.5T480-880q117 0 198.5 81.5T760-600q0 69-31.5 129.5T640-370v50q0 33-23.5 56.5T560-240H400Zm0-80h160v-92l34-24q41-28 63.5-71.5T680-600q0-83-58.5-141.5T480-800q-83 0-141.5 58.5T280-600q0 49 22.5 92.5T366-436l34 24v92Zm0 240q-17 0-28.5-11.5T360-120v-40h240v40q0 17-11.5 28.5T560-80H400Zm80-520Z"/></svg></span>
              <span *ngIf="activity.type === 'idea_voted'"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff7a00"><path d="M80-400q-33 0-56.5-23.5T0-480v-240q0-12 5-23t13-19l198-198 30 30q6 6 10 15.5t4 18.5v8L220-760h213.33q19.84 0 33.25 13.42Q480-733.17 480-713.33v42.66q0 6.67-1 12.17t-2.33 8.5l-92 217.33q-6.39 15.43-20.53 24.05Q350-400 330-400H80Zm238-80 87.33-204v-22.66h-276L164-818l-97.33 97.33v254H318ZM744 0l-30-30q-6-6-10-15.5T700-64v-8l28-128H520q-17 0-28.5-11.5T480-240v-50q0-6 1-11.5t3-10.5l90-212q8-17 23-26.5t33-9.5h250q33 0 56.5 23.5T960-480v240q0 12-4.5 22.5T942-198L744 0ZM642-480l-82 194v6h266l-24 108 78-76v-232H642Zm-562 0v-232 232Zm800 0v232-232Z"/></svg></span>
              <span *ngIf="activity.type === 'idea_commented'"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff7a00"><path d="M240-400h320v-80H240v80Zm0-120h480v-80H240v80Zm0-120h480v-80H240v80ZM80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg></span>
              <span *ngIf="activity.type === 'idea_approved' || activity.type === 'idea_rejected' || activity.type === 'idea_implemented'"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff7a00"><path d="M240-399.33h315.33V-466H240v66.67ZM240-526h480v-66.67H240V-526Zm0-126.67h480v-66.66H240v66.66ZM80-80v-733.33q0-27 19.83-46.84Q119.67-880 146.67-880h666.66q27 0 46.84 19.83Q880-840.33 880-813.33v506.66q0 27-19.83 46.84Q840.33-240 813.33-240H240L80-80Zm131.33-226.67h602v-506.66H146.67v575l64.66-68.34Zm-64.66 0v-506.66 506.66Z"/></svg></span>
            </div>
            <div class="activity-content">
              <p class="activity-text">{{ getActivityText(activity) }}</p>
              <span class="activity-time">{{ getActivityTime(activity) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="admin-section">
      <h2 class="section-title">Manage Ideas</h2>
      
      <div class="filters">
        <div class="search-box">
          <input 
            type="text" 
            placeholder="Search ideas..." 
            [(ngModel)]="searchQuery"
            (input)="applyFilters()"
          >
        </div>
        
        <div class="status-filter">
          <select [(ngModel)]="filterStatus" (change)="applyFilters()">
            <option value="all">All Status</option>
            <option value="pending">Pending</option>
            <option value="approved">Approved</option>
            <option value="rejected">Rejected</option>
            <option value="implemented">Implemented</option>
          </select>
        </div>
      </div>
      
      <div class="ideas-table">
        <table>
          <thead>
            <tr>
              <th>Title</th>
              <th>Author</th>
              <th>Category</th>
              <th>Status</th>
              <th>Votes</th>
              <th>Comments</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let idea of filteredIdeas">
              <td>{{ idea.title }}</td>
              <td>{{ getUserName(idea.user) }}</td>
              <td>{{ idea.category }}</td>
              <td>
                <span class="status-badge" [ngClass]="idea.status">
                  {{ idea.status }}
                </span>
              </td>
              <td>
                <span class="vote-count upvotes">+{{ idea.upVotes }}</span> / 
                <span class="vote-count downvotes">-{{ idea.downVotes }}</span>
              </td>
              <td>{{ idea.commentCount }}</td>
              <td class="actions">
                <button class="btn btn-sm btn-outline" (click)="viewIdeaDetails(idea)">View</button>
                <button class="btn btn-sm btn-outline" (click)="viewComments(idea)">Comments</button>
                <button 
                  *ngIf="idea.status === 'pending'" 
                  class="btn btn-sm btn-success" 
                  (click)="approveIdea(idea)"
                >
                  Approve
                </button>
                <button 
                  *ngIf="idea.status === 'pending'" 
                  class="btn btn-sm btn-danger" 
                  (click)="rejectIdea(idea)"
                >
                  Reject
                </button>
                <button 
                  *ngIf="idea.status === 'approved'" 
                  class="btn btn-sm btn-primary" 
                  (click)="implementIdea(idea)"
                >
                  Implement
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>

<!-- Idea Details Modal -->
<div *ngIf="selectedIdea" class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h2 class="modal-title">{{ selectedIdea.title }}</h2>
      <button class="modal-close" (click)="closeModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="idea-details">
        <div class="idea-meta">
          <span class="idea-author">By: {{ getUserName(selectedIdea.user) }}</span>
          <span class="idea-time">{{ selectedIdea.createdAt | date:'medium' }}</span>
          <span class="idea-status" [ngClass]="selectedIdea.status">
            {{ selectedIdea.status }}
          </span>
        </div>
        
        <div class="detail-section">
          <h3 class="detail-title">Description</h3>
          <div class="idea-content">
            <p>{{ selectedIdea.description }}</p>
          </div>
        </div>
        
        <div class="detail-section">
          <h3 class="detail-title">Category</h3>
          <p class="detail-value">{{ selectedIdea.category }}</p>
        </div>
        
        <div class="detail-section">
          <h3 class="detail-title">Impact Level</h3>
          <p class="detail-value">{{ selectedIdea.impactLevel }}</p>
        </div>
        
        <div class="detail-section" *ngIf="selectedIdea.requiredResources">
          <h3 class="detail-title">Required Resources</h3>
          <p class="detail-value">{{ selectedIdea.requiredResources }}</p>
        </div>
        
        <div class="detail-section" *ngIf="selectedIdea.hashtags && selectedIdea.hashtags.length > 0">
          <h3 class="detail-title">Hashtags</h3>
          <div class="idea-tags">
            <span *ngFor="let tag of selectedIdea.hashtags" class="idea-tag">
              #{{ tag }}
            </span>
          </div>
        </div>
        
        <div class="detail-section" *ngIf="selectedIdea.attachmentUrls && selectedIdea.attachmentUrls.length > 0">
          <h3 class="detail-title">Attachments</h3>
          <div class="attachments-list">
            <div *ngFor="let attachmentUrl of selectedIdea.attachmentUrls" class="attachment-item">
              <span class="attachment-icon">📎</span>
              <span class="attachment-name">{{ getAttachmentName(attachmentUrl) }}</span>
              <button class="btn btn-sm btn-outline" (click)="downloadAttachment(attachmentUrl, getAttachmentName(attachmentUrl))">
                Download
              </button>
            </div>
          </div>
        </div>
        
        <div class="idea-stats">
          <div class="stat">
            <span class="stat-label">Upvotes:</span>
            <span class="stat-value upvotes">{{ selectedIdea.upVotes }}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Downvotes:</span>
            <span class="stat-value downvotes">{{ selectedIdea.downVotes }}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Comments:</span>
            <span class="stat-value">{{ selectedIdea.commentCount }}</span>
          </div>
        </div>
        
        <div class="vote-actions">
          <button 
            class="vote-btn upvote" 
            (click)="vote(selectedIdea, 'up')"
          >
            👍 {{ selectedIdea.upVotes }}
          </button>
          
          <button 
            class="vote-btn downvote" 
            (click)="vote(selectedIdea, 'down')"
          >
            👎 {{ selectedIdea.downVotes }}
          </button>
        </div>
      </div>
      
      <div class="modal-actions">
        <button 
          *ngIf="selectedIdea.status === 'pending'" 
          class="btn btn-success" 
          (click)="approveIdea(selectedIdea); closeModal()"
        >
          Approve Idea
        </button>
        <button 
          *ngIf="selectedIdea.status === 'pending'" 
          class="btn btn-danger" 
          (click)="rejectIdea(selectedIdea); closeModal()"
        >
          Reject Idea
        </button>
        <button 
          *ngIf="selectedIdea.status === 'approved'" 
          class="btn btn-primary" 
          (click)="implementIdea(selectedIdea); closeModal()"
        >
          Mark as Implemented
        </button>
        <button class="btn btn-outline" (click)="viewComments(selectedIdea)">
          View Comments ({{ selectedIdea.commentCount }})
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Comments Modal -->
<div *ngIf="selectedIdeaForComments" class="modal-overlay">
  <div class="modal-container comments-modal">
    <div class="modal-header">
      <h2 class="modal-title">Comments for "{{ selectedIdeaForComments.title }}"</h2>
      <button class="modal-close" (click)="closeCommentsModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="comments-list">
        <div *ngIf="getIdeaComments(selectedIdeaForComments.id).length === 0" class="no-comments">
          <p>No comments yet for this idea.</p>
        </div>
        
        <div *ngFor="let comment of getIdeaComments(selectedIdeaForComments.id)" class="comment-item">
          <div class="comment-header">
            <span class="comment-author">{{ getUserName(comment.user) }}</span>
            <span class="comment-time">{{ comment.createdAt | date:'medium' }}</span>
          </div>
          <div class="comment-content">
            <p>{{ comment.text }}</p>
          </div>
        </div>
      </div>
      
      <div class="add-comment">
        <h3 class="comment-section-title">Add Your Comment</h3>
        <textarea 
          [(ngModel)]="newComment" 
          placeholder="Add an admin comment..."
          rows="3"
        ></textarea>
        <button 
          class="btn btn-primary" 
          [disabled]="!newComment.trim()" 
          (click)="addComment()"
        >
          Add Comment
        </button>
      </div>
    </div>
  </div>
</div>


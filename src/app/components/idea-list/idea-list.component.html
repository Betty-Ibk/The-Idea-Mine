<main class="main-content">
  <div class="container">
    <!-- User Engagement Metrics -->
    <div class="metrics-container">
      <h2 class="metrics-title">Your Innovation Impact</h2>
      
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="M127.33-240 80-287.33l293.33-293.34L538-416l230-229.33H648.67V-712H880v231.33h-66v-116.66L537.33-320.67 372.67-485.33 127.33-240Z"/></svg></div>
          <div class="metric-value">{{ userMetrics.topIdeas }}</div>
          <div class="metric-label">Ideas in Top 10%</div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="M280.67-623.33 357.33-700l-76.66-76.67L204-700l76.67 76.67ZM480-660ZM146.67-400q-27 0-46.84-19.83Q80-439.67 80-466.67v-386.66q0-27 19.83-46.84Q119.67-920 146.67-920h666.66q27 0 46.84 19.83Q880-880.33 880-853.33v386.66q0 27-19.83 46.84Q840.33-400 813.33-400H671q5.33-16 7.33-32.67 2-16.66 1.34-34h133.66v-386.66H146.67v386.66h133.66q-.66 17.34 1.34 34 2 16.67 7.33 32.67H146.67Zm513.37-283.33q23.63 0 40.13-16.54 16.5-16.54 16.5-40.17 0-23.63-16.54-40.13-16.54-16.5-40.17-16.5-23.63 0-40.13 16.54-16.5 16.54-16.5 40.17 0 23.63 16.54 40.13 16.54 16.5 40.17 16.5ZM200-40v-84q0-35 19.5-65t51.5-45q49-23 102-34.5T480-280q54 0 107 11.5T689-234q32 15 51.5 45t19.5 65v84H200Zm66.67-66.67h426.66V-124q0-15.75-9-28.88-9-13.12-24-20.12-42.66-19.67-88-30Q527-213.33 480-213.33T387.67-203q-45.34 10.33-88 30-15 7-24 20.12-9 13.13-9 28.88v17.33ZM480-320q-58 0-99-41t-41-99q0-58 41-99t99-41q58 0 99 41t41 99q0 58-41 99t-99 41Zm-.16-66.67q30.49 0 51.99-21.34 21.5-21.34 21.5-51.83t-21.34-51.99q-21.34-21.5-51.83-21.5t-51.99 21.34q-21.5 21.34-21.5 51.83t21.34 51.99q21.34 21.5 51.83 21.5ZM480-460Zm0 353.33Z"/></svg></div>
          <div class="metric-value">{{ userMetrics.engagementRate }}%</div>
          <div class="metric-label">Engagement Rate</div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="M356.67-300 480-394l123.33 94-48.66-156 114-76h-138L480-688.67 429.33-532h-138l114 76-48.66 156ZM233-120l93-304L80-600h304l96-320 96 320h304L634-424l93 304-247-188-247 188Zm247-374.33Z"/></svg></div>
          <div class="metric-value">{{ userMetrics.communityPoints }}</div>
          <div class="metric-label">Community Points</div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="m200-553.67 96.67 41Q313.33-546 332-578q18.67-32 40-62l-71.33-14.33L200-553.67ZM350-472l126.67 126.33q52-22.66 101.33-55.66T662-469q77.33-77.33 115.83-162.5T816.67-812q-95.34.33-180.67 38.83-85.33 38.5-162.67 115.84-34.66 34.66-67.66 84Q372.67-524 350-472Zm212-85.67q-21-21-21-51.83t21-51.83q21-21 52-21t52 21q21 21 21 51.83t-21 51.83q-21 21-52 21t-52-21Zm-3.67 362.34L659-296l-14.33-71.33q-30 21.33-62 39.83t-65.34 35.17l41 97ZM880-875.67q12.33 131-30.5 243.84Q806.67-519 706-418.33q-.67.66-1.33 1.33-.67.67-1.34 1.33l21.34 106.34Q728-292.67 723-277q-5 15.67-17 27.67L536-78.67l-84.67-197.66L281-446.67 83.33-531.33l170.34-170q12-12 27.83-17 15.83-5 32.5-1.67l106.33 21.33q.67-.66 1.34-1 .66-.33 1.33-1 100.67-100.66 213.33-144Q749-888 880-875.67Zm-728.33 552q35-35 85.5-35.5t85.5 34.5q35 35 34.5 85.5t-35.5 85.5q-25.67 25.67-81.5 43-55.84 17.34-162.84 32Q92-185.67 109-241.83q17-56.17 42.67-81.84Zm47 47.34Q186-263 175.33-232.83q-10.66 30.16-17.33 72.5 42.33-6.67 72.5-17.17 30.17-10.5 43.5-23.17 16.67-15.33 17.33-38Q292-261.33 276-278q-16.67-16-39.33-15.5-22.67.5-38 17.17Z"/></svg></div>
          <div class="metric-value">{{ userMetrics.implementedIdeas }}</div>
          <div class="metric-label">Ideas Implemented</div>
        </div>
      </div>
      
      <div class="achievement-banner">
        <div class="achievement-icon"><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#ff7a00"><path d="m363-310 117-71 117 71-31-133 104-90-137-11-53-126-53 126-137 11 104 90-31 133ZM480.67-28.67 346-160H160v-186L26.67-480 160-614v-186h186l134.67-133.33L614-800h186v186l133.33 134L800-346v186H614L480.67-28.67Zm0-93.33 105.27-104.67h147.39V-374l106-106-106-106v-147.33H586l-105.33-106-106.67 106H226.67V-586l-106 106 106 106v147.33h146.66L480.67-122Zm0-358.67Z"/></svg></div>
        <div class="achievement-content">
          <div class="achievement-title">Weekly Goal Progress</div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="userMetrics.weeklyGoalProgress"></div>
          </div>
          <div class="achievement-text">
            {{ getWeeklyGoalMessage(userMetrics.weeklyIdeasSubmitted) }}
          </div>
        </div>
      </div>
    </div>
    
    <h2 class="page-title" style="color: #FF7A00">Recent Ideas</h2>
    <div class="ideas-list">
      @for (idea of ideas; track idea.id) {
        <div class="idea-card">
          <div class="idea-content">
            <h3 class="idea-title">{{idea.title}}</h3>
            <p class="idea-description">{{idea.description}}</p>
            <div class="idea-meta">
              <span class="author">{{getDisplayName(idea.authorId, idea.author)}}</span>
              <span class="timestamp">{{idea.timestamp}}</span>
            </div>
          </div>
          <div class="idea-actions">
            <button 
              class="vote-button upvote" 
              [class.voted]="idea.userVote === 'up'"
              (click)="vote(idea, 'up')">
              üëç {{idea.upvotes}}
            </button>
            <button 
              class="vote-button downvote" 
              [class.voted]="idea.userVote === 'down'"
              (click)="vote(idea, 'down')">
              üëé {{idea.downvotes}}
            </button>
            <button class="comment-button" (click)="viewComments(idea)">
              üí¨ {{idea.comments}}
            </button>
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Comments Modal -->
  @if (selectedIdea) {
    <div class="modal-overlay">
      <div class="comments-modal">
        <div class="modal-header">
          <h3>Comments for "{{selectedIdea.title}}"</h3>
          <button class="close-btn" (click)="closeCommentsModal()">√ó</button>
        </div>
        <div class="comments-list">
          @if (selectedIdea.commentsList && selectedIdea.commentsList.length === 0) {
            <div class="no-comments">
              No comments yet.
            </div>
          }
          @for (comment of getVisibleComments(); track comment.timestamp) {
            <div class="comment-item">
              <div class="comment-header">
                <span class="comment-author">{{getDisplayName(comment.authorId, comment.author)}}</span>
                <span class="comment-time">{{comment.timestamp}}</span>
              </div>
              <div class="comment-content">
                <p>{{comment.text}}</p>
              </div>
            </div>
          }
          @if (currentPage < totalPages - 1) {
            <div class="pagination-controls">
              <button class="btn btn-outline" (click)="nextPage()">Next</button>
            </div>
          }
          @if (currentPage > 0) {
            <div class="pagination-controls">
              <button class="btn btn-outline" (click)="prevPage()">Previous</button>
            </div>
          }
        </div>
        
        <!-- Add Comment Form -->
        <div class="add-comment-form">
          <h4>Add a Comment</h4>
          <textarea 
            [(ngModel)]="newComment" 
            placeholder="Write your comment here..." 
            rows="3"
            class="comment-input"
          ></textarea>
          <button 
            class="btn btn-primary" 
            [disabled]="!newComment.trim()" 
            (click)="addComment()"
          >
            Submit Comment
          </button>
        </div>
      </div>
    </div>
  }
</main>
